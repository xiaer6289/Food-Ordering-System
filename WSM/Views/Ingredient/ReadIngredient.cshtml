@using WSM.Models
@using X.PagedList
@using X.PagedList.Mvc.Core
@model IPagedList<WSM.Models.Ingredient>

@{
    ViewBag.Title = "Restock";
    string[] fields = ["","Id", "Name", "Quantity", "Weight(kg)", "Unit Price", ""];
}


<form method="post" action="/Ingredient/DeleteMany" id="deleteForm">
    <p>
        <button type="button" class="check-all-btn">Check All</button>
        <button type="button" class="uncheck-all-btn">Uncheck All</button>
    </p>

    <div class="restock-container" id="target">
        <partial name="_ReadIngredient" />
    </div>
</form>

@section Scripts {
    <script>
        $(document).ready(function() {
            // Check all functionality
            $('.check-all-btn').click(function() {
                $('.ingredient-checkbox').prop('checked', true);
            });

            // Uncheck all functionality
            $('.uncheck-all-btn').click(function() {
                $('.ingredient-checkbox').prop('checked', false);
            });

            // Single row delete
            $('.remove-ingredient').click(function() {
                var button = $(this);
                var id = button.data('id');
                
                if (confirm('Are you sure you want to delete this ingredient?')) {
                    $.ajax({
                        url: '/Ingredient/Delete',
                        type: 'POST',
                        data: { id: id },
                        success: function() {
                            // Remove the row from the table
                            button.closest('tr').fadeOut(300, function() {
                                $(this).remove();
                                updateCount(-1);
                            });
                        },
                        error: function() {
                            alert('An error occurred while deleting the ingredient.');
                        }
                    });
                }
            });

            // Bulk delete for selected items
            $('#deleteForm').submit(function(e) {
                e.preventDefault();
                var checkedBoxes = $('.ingredient-checkbox:checked');
                if (checkedBoxes.length === 0) {
                    alert('Please select at least one ingredient to delete.');
                    return false;
                }
                if (!confirm('Are you sure you want to delete the selected ingredients?')) {
                    return false;
                }

                var form = $(this);
                $.ajax({
                    url: form.attr('action'),
                    type: 'POST',
                    data: form.serialize(),
                    success: function() {
                        // Remove checked rows
                        $('.ingredient-checkbox:checked').closest('tr').fadeOut(300, function() {
                            $(this).remove();
                            updateCount(-checkedBoxes.length);
                        });
                    },
                    error: function () {
                        alert('An error occurred while deleting.');
                    }
                });
                return false;
            });
        });
    </script>
}
