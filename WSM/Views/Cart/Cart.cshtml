<h3>🛒 My Cart (Seat @ViewBag.SeatNo)</h3>

@if ((ViewBag.CartItems != null && ViewBag.CartItems.Count > 0) ||
     (ViewBag.PreviousOrders != null && ViewBag.PreviousOrders.Count > 0))
{
    <!-- Current Cart -->
    @if (ViewBag.CartItems != null && ViewBag.CartItems.Count > 0)
    {
        <h4>Current Cart</h4>
        <table class="table table-bordered table-striped">
            <thead class="table-dark">
                <tr>
                    <th>Food</th>
                    <th>Quantity</th>
                    <th>Extra Detail</th>
                    <th>Price</th>
                    <th>Subtotal</th>
                    <th>Action</th>
                </tr>
            </thead>
            <tbody>
                @foreach (var item in ViewBag.CartItems)
                {
                    <tr>
                        <td>@item.Food.Name</td>
                        <td>@item.Quantity.Quantity</td>
                        <td>@item.Quantity.ExtraDetail</td>
                        <td>RM @item.Food.Price</td>
                        <td>RM @(item.Food.Price* item.Quantity.Quantity)</td>
                        <td>
                            <a asp-controller="Cart" asp-action="Remove" asp-route-seatNo="@ViewBag.SeatNo" asp-route-foodId="@item.Food.Id" class="btn btn-danger btn-sm">Remove</a>
                        </td>
                    </tr>
                }
            </tbody>
        </table>

        <h5>Total: RM @ViewBag.TotalAmount</h5>

        <form asp-controller="Cart" asp-action="SendOrder" method="post" class="mb-3">
            <input type="hidden" name="seatNo" value="@ViewBag.SeatNo" />
            <button type="submit" class="btn btn-primary">Send Order</button>
        </form>
    }

    <!-- Checkout Button -->
    <form asp-controller="Payment" asp-action="CreateCheckoutSession" method="post">
        <input type="hidden" name="seatNo" value="@ViewBag.SeatNo" />
        <button type="submit" class="btn btn-success btn-lg">
            Checkout
        </button>
    </form>

    <hr />

    <!-- Previous Orders -->
    @if (ViewBag.PreviousOrders != null && ViewBag.PreviousOrders.Count > 0)
    {
        <h4>Previous Orders</h4>
        @foreach (var order in ViewBag.PreviousOrders)
        {
            <div class="card mb-3">
                <div class="card-header bg-info text-white">
                    Order ID: @order.Id | Status: @order.Status | Date: @order.OrderDate.ToString("yyyy-MM-dd HH:mm")
                </div>
                <div class="card-body">
                    <table class="table table-sm table-striped">
                        <thead>
                            <tr>
                                <th>Food</th>
                                <th>Quantity</th>
                                <th>Extra Detail</th>
                                <th>Price</th>
                                <th>Subtotal</th>
                            </tr>
                        </thead>
                        <tbody>
                            @foreach (var item in order.OrderItems)
                            {
                                <tr>
                                    <td>@item.Food.Name</td>
                                    <td>@item.Quantity</td>
                                    <td>@item.ExtraDetail</td>
                                    <td>RM @item.Food.Price</td>
                                    <td>RM @item.SubTotal</td>
                                </tr>
                            }
                        </tbody>
                    </table>
                </div>
            </div>
        }
    }
}
else
{
    <p>Your cart and previous orders are empty.</p>
}
