@using X.PagedList
@using X.PagedList.Mvc.Core
@model IPagedList<WSM.Models.Admin>

@{
    ViewData["Title"] = "Admin Management";
}

@if (TempData["ErrorMessage"] != null)
{
    <div class="alert alert-danger">
        @TempData["ErrorMessage"]
    </div>
}

@if (TempData["SuccessMessage"] != null)
{
    <div class="alert alert-success">
        @TempData["SuccessMessage"]
    </div>
}


<!-- Hidden form for sorting -->
<form method="get">
    @Html.Hidden("sort")
    @Html.Hidden("dir")
</form>

@if (!Model.Any())
{
    <p>No admins found.</p>
}
else
{
    <p class="pagination-count">
        @Model.Count() of @Model.TotalItemCount Admins |
        Page @Model.PageNumber of @Model.PageCount
    </p>

    <form method="post" asp-action="DeleteMany" asp-controller="Admin" id="deleteForm">
        @Html.AntiForgeryToken()

        <div style="display: flex; align-items: flex-start; gap: 20px;">
            <table class="record-table">
                <thead>
                    <tr>
                        <th>
                        </th>

                        @* Sort by ID *@
                        @{
                            string idDirection = (ViewBag.Sort == "Id" && ViewBag.Dir == "asc") ? "des" : "asc";
                            string idClass = (ViewBag.Sort == "Id") ? ViewBag.Dir : "";
                        }
                        <th>
                            <a href="?name=@ViewBag.Name&sort=Id&dir=@idDirection" class="@idClass">Id</a>
                        </th>

                        @* Sort by Name *@
                        @{
                            string nameDirection = (ViewBag.Sort == "Name" && ViewBag.Dir == "asc") ? "des" : "asc";
                            string nameClass = (ViewBag.Sort == "Name") ? ViewBag.Dir : "";
                        }
                        <th>
                            <a href="?name=@ViewBag.Name&sort=Name&dir=@nameDirection" class="@nameClass">Name</a>
                        </th>

                        <th>Email</th>
                        <th>Phone Number</th>
                        <th>Actions</th>
                    </tr>
                </thead>

                <tbody>
                    @foreach (var admin in Model)
                    {
                        var superAdminId = Model.Min(a => a.Id); // SuperAdmin is first created
                        bool isSuperAdmin = admin.Id == superAdminId;
                        string rowClass = isSuperAdmin ? "superadmin-row" : "";

                        <tr data-checkable data-id="@admin.Id" class="@rowClass">
                            <td>
                                <input type="checkbox" name="ids" value="@admin.Id" class="admin-checkbox" @(isSuperAdmin ? "disabled" : "") />
                            </td>
                            <td>@admin.Id</td>
                            <td>@admin.Name @(isSuperAdmin ? "(SuperAdmin)" : "")</td>
                            <td>@admin.Email</td>
                            <td>@admin.PhoneNo</td>
                            <td>
                                <div class="edit-remove-group">
                                    <a asp-controller="Admin" asp-action="EditAdmin" asp-route-id="@admin.Id" class="edit-ingredient">Edit</a>
                                    <a asp-controller="Admin" asp-action="DeleteAdmin"
                                       asp-route-id="@admin.Id"
                                       data-admin-name="@admin.Name"
                                       class="remove-ingredient delete-admin"
                                       onclick="return confirm('Are you sure you want to delete this admin?');">
                                        Delete
                                    </a>
                                </div>
                            </td>
                        </tr>
                    }
                </tbody>
            </table>

            <div class="restock-button">
                <a asp-controller="Admin" asp-action="CreateAdmin" class="create-ingredient">Add New Admin</a>
                <button type="submit" class="remove-check-ingredient btn btn-danger"
                        onclick="return confirm('Are you sure you want to delete the selected admins?');">
                    Delete Selected
                </button>
            </div>
        </div>
    </form>

    <!-- Pagination -->
    <div class="pagination-wrapper">
        @{
            var options = PagedListRenderOptions.ClassicPlusFirstAndLast;
            options.LinkToFirstPageFormat = "First";
            options.LinkToLastPageFormat = "Last";
            options.LinkToPreviousPageFormat = "Previous";
            options.LinkToNextPageFormat = "Next";
        }

        @Html.PagedListPager(
        Model,
        page => $"?name={ViewBag.Name}&sort={ViewBag.Sort}&dir={ViewBag.Dir}&page={page}",
        options
        )
</div>
}


