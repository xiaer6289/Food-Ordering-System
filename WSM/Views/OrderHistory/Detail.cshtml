@using WSM.Models
@model DetailVM

@{
    ViewBag.Title = "Print Order Details";
    Layout = null;
}



<link rel="stylesheet" href="~/css/app.css" asp-append-version="true">
<script src="https://cdnjs.cloudflare.com/ajax/libs/html2pdf.js/0.10.1/html2pdf.bundle.min.js" integrity="sha512-GsLlZN/3F2ErC5ifS5QtgpiJtWd43JWSuIgh7mbzZ8zBps+dvLusV+eNQATqgA/HdeKFVgA5v3S/cIrLF7QnIg==" crossorigin="anonymous" referrerpolicy="no-referrer"></script>
<script src="~/js/app.js" asp-append-version="true"></script>

<div id="PDF">
    <div style="text-align:center;" class="read-details-header">
        <div class="page-logo">
            <img src="@Url.Content(
                     string.IsNullOrEmpty(Context.Session.GetString("CompanyLogo"))
                           ? "~/images/default-logo.png"
                           : Context.Session.GetString("CompanyLogo")
                )" alt="Company Logo" style="max-height:50px;" />
        </div>
        <h1><strong>@Model.company.CompanyName</strong></h1>
        <h4>@Model.company.Street, @Model.company.Postcode</h4>
        <h4>@Model.company.City, @Model.company.State</h4>

        <div class="order-info">
            <span>Date: @Model.orderDetail.OrderDate.ToString("yyyy-MM-dd HH:mm")</span>
            <br>
            <span>Order ID: @Model.orderDetail.Id</span>
        </div>
        <div class="additional-info">
            <span>Table No: @Model.orderDetail.SeatNo</span>
            <br>
            <span>Status: @Model.orderDetail.Status</span>
            <br>
        </div>
    </div>

    <table class="detail-table">
        <tr style="border-top:2px solid black;">
            <th><h3>No.</h3></th>
            <th><h3>Food Ordered</h3></th>
            <th><h3>Quantity</h3></th>
            <th><h3>Unit Price (RM)</h3></th>
            <th><h3>Subtotal (RM)</h3></th>
        </tr>

        @for (int i = 0; i < Model.orderDetail.OrderItems.Count; i++)
        {
            var item = Model.orderDetail.OrderItems.ElementAt(i);
            <tr>
                <td>@(i + 1)</td>
                <td>@item.Food?.Name</td>
                <td>@item.Quantity</td>
                <td>@item.Food?.Price.ToString("F2")</td>
                <td>@item.SubTotal.ToString("F2")</td>
            </tr>
        }
        
        <tr>
            <td style="text-align:right;" colspan="4">
                <strong>Subtotal:</strong>
            </td>
            <td>
                RM @Model.orderDetail.TotalPrice.ToString("F2")
            </td>
        </tr>
        <tr>
            <td colspan="4" style="text-align:right">
                <strong>Service charge (6%):</strong>
            </td>
            <td>
                RM @((Model.orderDetail.TotalPrice * 0.06M).ToString("F2"))
            </td>
        </tr>
        <tr>
            <td colspan="4" style="text-align:right">
                <strong>Total:</strong>
            </td>
            <td>
                <strong>RM @((Model.orderDetail.TotalPrice * 1.06M).ToString("F2"))</strong>
            </td>
        </tr>
    </table>

    @if (Model.orderDetail.Payment != null)
    {
        <div class="payment-info">
            <p>Payment Details:</p>
            <p>Payment Method: @Model.orderDetail.Payment.PaymentMethod</p>
            <p>Amount Paid: RM @Model.orderDetail.Payment.AmountPaid.ToString("F2")</p>
            @if (Model.orderDetail.Payment.PaymentMethod == "Cash" && Model.orderDetail.Payment.AmountPaid >= (Model.orderDetail.TotalPrice * 1.06M))
            {
                decimal change = Model.orderDetail.Payment.AmountPaid - (Model.orderDetail.TotalPrice * 1.06M);
                <p>Change: RM @change.ToString("F2")</p>
            }
            @if (!string.IsNullOrEmpty(Model.orderDetail.Payment.StripeTransactionId))
            {
                <p>Transaction ID: @Model.orderDetail.Payment.StripeTransactionId</p>
            }
        </div>
    }
</div>

<button type="button" onclick="generatePDF()" id="savePdf">Save in PDF 🗎</button>

<br>

<p>
    <div class="return-OrderHistory">
        <a asp-action="OrderHistory" class="return-orderhistory" type="button">Return</a>
    </div>
</p>

