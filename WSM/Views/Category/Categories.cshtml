@using X.PagedList
@using X.PagedList.Mvc.Core
@model IPagedList<WSM.Models.CategoryVM>

@{
    ViewData["Title"] = "Category Management";
}

<h2 class="mb-4">Category Management</h2>

<form method="get">
    @Html.Hidden("sort")
    @Html.Hidden("dir")
</form>

@if (!Model.Any())
{
    <p>No categories found.</p>
}
else
{
    <p class="pagination-count">
        @Model.Count() of @Model.TotalItemCount Categories |
        Page @Model.PageNumber of @Model.PageCount
    </p>

    <form method="post" asp-action="DeleteMany" asp-controller="Category" id="deleteForm">
        @Html.AntiForgeryToken()

        <div style="display: flex; align-items: flex-start; gap: 20px;">
            <table class="record-table">
                <thead>
                    <tr>
                        <th></th>

                        @* Sort by Id *@
                        @{
                            string idDirection = (ViewBag.Sort == "Id" && ViewBag.Dir == "asc") ? "des" : "asc";
                            string idClass = (ViewBag.Sort == "Id") ? ViewBag.Dir : "";
                        }
                        <th>
                            <a href="?searchString=@ViewBag.Search&sort=Id&dir=@idDirection" class="@idClass">Id</a>
                        </th>

                        @* Sort by Name *@
                        @{
                            string nameDirection = (ViewBag.Sort == "Name" && ViewBag.Dir == "asc") ? "des" : "asc";
                            string nameClass = (ViewBag.Sort == "Name") ? ViewBag.Dir : "";
                        }
                        <th>
                            <a href="?searchString=@ViewBag.Search&sort=Name&dir=@nameDirection" class="@nameClass">Name</a>
                        </th>

                        <th>Actions</th>
                    </tr>
                </thead>

                <tbody>
                    @foreach (var category in Model)
                    {
                        <tr data-checkable data-id="@category.Id">
                            <td>
                                <input type="checkbox" name="ids" value="@category.Id" class="category-checkbox" />
                            </td>
                            <td>@category.Id</td>
                            <td>@category.Name</td>
                            <td>
                                <div class="edit-remove-group">
                                    <a asp-controller="Category" asp-action="EditCategory" asp-route-id="@category.Id" class="edit-ingredient">
                                        Edit
                                    </a>
                                    <a asp-controller="Category" asp-action="DeleteConfirmed"
                                       asp-route-id="@category.Id"
                                       data-category-name="@category.Name"
                                       class="remove-ingredient delete-category"
                                       onclick="return confirm('Are you sure you want to delete this category?');">
                                        Delete
                                    </a>
                                </div>
                            </td>
                        </tr>
                    }
                </tbody>
            </table>

            <div class="restock-button">
                <a asp-controller="Category" asp-action="CreateCategory" class="create-ingredient">Add New Category</a>
                <button type="submit" class="remove-check-ingredient btn btn-danger"
                        onclick="return confirm('Are you sure you want to delete the selected categories?');">
                    Delete Selected
                </button>
            </div>
        </div>
    </form>

    <!-- Pagination -->
    <div class="pagination-wrapper">
        @{
            var options = PagedListRenderOptions.ClassicPlusFirstAndLast;
            options.LinkToFirstPageFormat = "First";
            options.LinkToLastPageFormat = "Last";
            options.LinkToPreviousPageFormat = "Previous";
            options.LinkToNextPageFormat = "Next";
        }

        @Html.PagedListPager(
        Model,
        page => $"?searchString={ViewBag.Search}&sort={ViewBag.Sort}&dir={ViewBag.Dir}&page={page}",
        options
        )
</div>
}
